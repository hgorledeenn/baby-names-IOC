df_no_ethn %>%
ggplot() +
aes(x=`Year of Birth`, y=pct_diff) +
geom_line()
df_no_ethn %>%
ggplot() +
aes(x=`Year of Birth`, y=pct_diff) +
geom_line(stat="name")
df_no_ethn %>%
ggplot() +
aes(x=`Year of Birth`, y=pct_diff) +
geom_line(stat="identity")
df_no_ethn %>%
ggplot() +
aes(x=`Year of Birth`, y=pct_diff, color=name) +
geom_line()
df_no_ethn %>%
ggplot() +
aes(x=`Year of Birth`, y=pct_diff, color=name) +
geom_line
df_no_ethn %>%
ggplot() +
aes(x=`Year of Birth`, y=pct_diff, color=name) +
geom_line()
df_no_ethn %>%
ggplot() +
aes(x=`Year of Birth`, y=pct_diff, group=name) +
geom_line()
df_no_ethn %>%
ggplot() +
aes(x=`Year of Birth`, y=pct_diff, group=name, color=name) +
geom_line()
df_no_ethn %>%
ggplot() +
aes(x=`Year of Birth`, y=pct_diff, group=name) +
geom_line()
df_no_ethn %>%
ggplot() +
aes(x=`Year of Birth`, y=pct_diff, group=name) +
geom_line(alpha=0.1)
df_no_ethn <- df %>%
group_by(`Year of Birth`, Gender, name) %>%
summarize(sum_count = sum(Count)) %>%
pivot_wider(names_from = Gender, values_from = sum_count, values_fill = 0) %>%
mutate(pct_diff = (FEMALE-MALE)/(FEMALE+MALE)) %>%
mutate(total_count = (FEMALE+MALE))
df_no_ethn %>%
ggplot() +
aes(x=`Year of Birth`, y=pct_diff, group=name, color=total_count) +
geom_line(alpha=0.1)
df_no_ethn %>%
ggplot() +
aes(x=`Year of Birth`, y=pct_diff, group=name, color=total_count) +
geom_line(alpha=0.5)
df_no_ethn %>%
ggplot() +
aes(x=`Year of Birth`, y=pct_diff, group=name, color=total_count) +
geom_line(alpha=total_count)
df_no_ethn %>%
ggplot() +
aes(x=`Year of Birth`, y=pct_diff, group=name, alpha=total_count) +
geom_line()
df_no_ethn %>%
ggplot() +
aes(x=`Year of Birth`, y=pct_diff, group=name, alpha=total_count) +
geom_line()
df = read_csv("~/Desktop/CJS/0126algorithms/HW-in-one-chart-1/BABY NAMES/Popular_Baby_Names_20260203.csv")
library(tidyverse)
df = read_csv("~/Desktop/CJS/0126algorithms/HW-in-one-chart-1/BABY NAMES/Popular_Baby_Names_20260203.csv")
df <- df %>%
mutate(name = str_to_title(`Child's First Name`))
df_no_ethn <- df %>%
group_by(`Year of Birth`, Gender, name) %>%
summarize(sum_count = sum(Count)) %>%
pivot_wider(names_from = Gender, values_from = sum_count, values_fill = 0) %>%
mutate(pct_diff = (FEMALE-MALE)/(FEMALE+MALE)) %>%
mutate(total_count = (FEMALE+MALE))
df_no_ethn_diff_byyear <- df_no_ethn %>%
pivot_wider(names_from = `Year of Birth`, values_from = pct_diff) %>%
select(-FEMALE, -MALE)
df_no_ethn %>%
ggplot() +
aes(x=`Year of Birth`, y=pct_diff, group=name, alpha=total_count) +
geom_line()
View(df)
View(df_no_ethn)
View(df)
View(df_no_ethn_diff_byyear)
## Load necessary packages
library(tidyverse)
library(glue)
library(ggrepel)
## Set WD and read in data
setwd("~/Desktop/CJS/0126algorithms/HW-in-one-chart-1/BABY NAMES")
df = read_csv("~/Desktop/CJS/0126algorithms/HW-in-one-chart-1/BABY NAMES/Popular_Baby_Names_20260203.csv")
## Make sure each name is formatted consistently (helps with grouping by name later)
df <- df %>%
mutate(name = str_to_title(`Child's First Name`)) %>%
select(-`Child's First Name`)
## 1. Remove "ethnicity" variable and group remaining results by year, gender & name
df_one_row_per_name_yr <- df %>%
group_by(`Year of Birth`, Gender, name) %>%
summarize(sum_count = sum(Count)) %>%
## 2. Pivot wider to create only one row per name/year combo, with columns for Male and Female counts
pivot_wider(names_from = Gender, values_from = sum_count, values_fill = 0) %>%
## 3. Create column showing percentage difference between male and female counts
##    (all female = 1, all male = -1)
mutate(pct_diff = (FEMALE-MALE)/(FEMALE+MALE)) %>%
mutate(total_count = (FEMALE+MALE))
## Create a DF with only one row per name, columns for yearly pct_diff (pct_diff is NA where count=0)
wide_with_var <- df_one_row_per_name_yr %>%
select(name, `Year of Birth`, pct_diff) %>%
pivot_wider(
names_from = `Year of Birth`,
values_from = pct_diff
) %>%
rowwise() %>%
## Add variance column showing variance in pct_diff over time
mutate(
variance = var(c_across(`2011`:`2021`), na.rm = TRUE)
) %>%
ungroup() %>%
select(name, variance, `2011`:`2021`)
## Add sum column for measuring total of pct_diff over time per name
##    (used for assigning ranks to order plots for animation)
wide_with_var <- wide_with_var %>%
mutate(sum_pct_diff = rowSums(wide_with_var[c("2011","2012","2013","2014",
"2015","2016","2017","2018",
"2019","2020","2021")], na.rm=TRUE))
## Create dataframe for intermediate step of creating a list of names with variance>0
only_w_variance <- wide_with_var %>%
filter(variance>0)
## Save the list of names with variance>0 for later reference
variance_list <- only_w_variance$name
## Filter larger dataframe to only names contained in variance_list
wide_with_var <- wide_with_var %>%
filter(name %in% variance_list) %>%
## Sort first by sum_pct_diff, higher values first
arrange(
desc(sum_pct_diff),
## If ties exist, sort by variance, higher values first
desc(variance),
## If ties exist, sort alphabetically
name
) %>%
mutate(
## Add rank as row # of sorted dataframe
rank = row_number()
)
## Rather than pivoting wide_with_var to long for ggplot, I filter df_one_row_per_name_yr
##    to only the names in variance_list
df_with_var <- df_one_row_per_name_yr %>%
filter(name %in% variance_list)
## Making the individual plots for EXPLORATORY DATA ANALYSIS
for (i in variance_list) {
## 1. Define/find some variables for later
title <- paste0("All names with variance>0 in the dataset with ", i, " highlighted")
sum <- sum(df_with_var$total_count[df_with_var$name == i])
var <- sum(wide_with_var$variance[wide_with_var$name == i])
current_rank <- wide_with_var %>%
filter(name == i) %>%
pull(rank)
subtitle <- paste0("The name ", i, " appeared ", sum, " times in the dataset and had a variance of ", var, ".")
## 2. Make the plot
p <- ggplot(data = df_with_var) +
aes(x=`Year of Birth`, y=pct_diff, group=name) +
## 3. First geom_line adds all names as black lines
geom_line(color="black", linewidth=0.5) +
## 4. Second geom_line adds the particular name in a thicker red line on top
geom_line(data = filter(df_with_var, name==i), color = "red", linewidth=1) +
## 5. Geom_label_repel adds individual data points as text to the chart, only for the highlighted name
geom_label_repel(data = filter(df_with_var, name==i),
aes(label = paste0(`Year of Birth`, "\nFemale: ", FEMALE, "\nMale: ", MALE)),
fill = "white",
size=2,
alpha=0.9) +
## 6. Reference previously defined variables to add labels
labs(
title = title,
subtitle = str_wrap(subtitle, 60)
)
filename <- paste0("plots/", current_rank, "-", i, ".png")
ggsave(filename, plot=p, width = 6, height = 4, units = "in")
}
## Load necessary packages
library(tidyverse)
library(glue)
library(ggrepel)
## Set WD and read in data
setwd("~/Desktop/CJS/0126algorithms/HW-in-one-chart-1/BABY NAMES")
df = read_csv("~/Desktop/CJS/0126algorithms/HW-in-one-chart-1/BABY NAMES/Popular_Baby_Names_20260203.csv")
## Make sure each name is formatted consistently (helps with grouping by name later)
df <- df %>%
mutate(name = str_to_title(`Child's First Name`)) %>%
select(-`Child's First Name`)
## 1. Remove "ethnicity" variable and group remaining results by year, gender & name
df_one_row_per_name_yr <- df %>%
group_by(`Year of Birth`, Gender, name) %>%
summarize(sum_count = sum(Count)) %>%
## 2. Pivot wider to create only one row per name/year combo, with columns for Male and Female counts
pivot_wider(names_from = Gender, values_from = sum_count, values_fill = 0) %>%
## 3. Create column showing percentage difference between male and female counts
##    (all female = 1, all male = -1)
mutate(pct_diff = (FEMALE-MALE)/(FEMALE+MALE)) %>%
mutate(total_count = (FEMALE+MALE))
## Create a DF with only one row per name, columns for yearly pct_diff (pct_diff is NA where count=0)
wide_with_var <- df_one_row_per_name_yr %>%
select(name, `Year of Birth`, pct_diff) %>%
pivot_wider(
names_from = `Year of Birth`,
values_from = pct_diff
) %>%
rowwise() %>%
## Add variance column showing variance in pct_diff over time
mutate(
variance = var(c_across(`2011`:`2021`), na.rm = TRUE)
) %>%
ungroup() %>%
select(name, variance, `2011`:`2021`)
## Add sum column for measuring total of pct_diff over time per name
##    (used for assigning ranks to order plots for animation)
wide_with_var <- wide_with_var %>%
mutate(sum_pct_diff = rowSums(wide_with_var[c("2011","2012","2013","2014",
"2015","2016","2017","2018",
"2019","2020","2021")], na.rm=TRUE))
## Create dataframe for intermediate step of creating a list of names with variance>0
only_w_variance <- wide_with_var %>%
filter(variance>0)
## Save the list of names with variance>0 for later reference
variance_list <- only_w_variance$name
## Filter larger dataframe to only names contained in variance_list
wide_with_var <- wide_with_var %>%
filter(name %in% variance_list) %>%
## Sort first by sum_pct_diff, higher values first
arrange(
desc(sum_pct_diff),
## If ties exist, sort by variance, higher values first
desc(variance),
## If ties exist, sort alphabetically
name
) %>%
mutate(
## Add rank as row # of sorted dataframe
rank = row_number()
)
## Load necessary packages
library(tidyverse)
library(glue)
library(ggrepel)
## Set WD and read in data
setwd("~/Desktop/CJS/0126algorithms/HW-in-one-chart-1/BABY NAMES")
df = read_csv("~/Desktop/CJS/0126algorithms/HW-in-one-chart-1/BABY NAMES/Popular_Baby_Names_20260203.csv")
df = read_csv("~/Desktop/CJS/0126algorithms/HW-in-one-chart-1/Popular_Baby_Names_20260203.csv")
df = read_csv("~/Desktop/CJS/0126algorithms/HW-in-one-chart-1/Popular_Baby_Names_20260203.csv")
## Make sure each name is formatted consistently (helps with grouping by name later)
df <- df %>%
mutate(name = str_to_title(`Child's First Name`)) %>%
select(-`Child's First Name`)
## 1. Remove "ethnicity" variable and group remaining results by year, gender & name
df_one_row_per_name_yr <- df %>%
group_by(`Year of Birth`, Gender, name) %>%
summarize(sum_count = sum(Count)) %>%
## 2. Pivot wider to create only one row per name/year combo, with columns for Male and Female counts
pivot_wider(names_from = Gender, values_from = sum_count, values_fill = 0) %>%
## 3. Create column showing percentage difference between male and female counts
##    (all female = 1, all male = -1)
mutate(pct_diff = (FEMALE-MALE)/(FEMALE+MALE)) %>%
mutate(total_count = (FEMALE+MALE))
## Create a DF with only one row per name, columns for yearly pct_diff (pct_diff is NA where count=0)
wide_with_var <- df_one_row_per_name_yr %>%
select(name, `Year of Birth`, pct_diff) %>%
pivot_wider(
names_from = `Year of Birth`,
values_from = pct_diff
) %>%
rowwise() %>%
## Add variance column showing variance in pct_diff over time
mutate(
variance = var(c_across(`2011`:`2021`), na.rm = TRUE)
) %>%
ungroup() %>%
select(name, variance, `2011`:`2021`)
## Add sum column for measuring total of pct_diff over time per name
##    (used for assigning ranks to order plots for animation)
wide_with_var <- wide_with_var %>%
mutate(sum_pct_diff = rowSums(wide_with_var[c("2011","2012","2013","2014",
"2015","2016","2017","2018",
"2019","2020","2021")], na.rm=TRUE))
library(tidyverse)
library(ggrepel)
library(scales)
setwd("~/Desktop/CJS/0126algorithms/HW-in-one-chart-1/")
## Read in the data (which doesn't have headers) and assign column names
df <- read.csv("~/Desktop/CJS/0126algorithms/HW-in-one-chart-1/namesbystate/NY.TXT",
header = FALSE, col.names = c('state', 'gender', 'year', 'name', 'count'))
EDA_year_sum_count <- df %>%
group_by(year) %>%
summarise(sum_count = sum(count)) %>%
mutate(pct_total = (sum_count/sum(sum_count))*100)
## Google told me this make a global setting to prefer raw numbers for ggplot axes
## over scientific notation
options(scipen = 999)
EDA_year_bygender_sum_count <- df %>%
group_by(year, gender) %>%
summarise(sum_count = sum(count)) %>%
mutate(pct_total = (sum_count/sum(sum_count))*100)
EDA_year_sum_count %>%
ggplot() +
aes(x=year, y=sum_count) +
geom_line()
EDA_year_bygender_sum_count %>%
ggplot() +
aes(x=year, y=sum_count, color=gender) +
geom_line() +
scale_color_manual(values = c("F" = "red", "M" = "blue"))
EDA_year_sum_count %>%
ggplot() +
aes(x=year, y=pct_total) +
geom_line()
EDA_year_bygender_sum_count %>%
ggplot() +
aes(x=year, y=pct_total, color=gender) +
geom_line() +
scale_color_manual(values = c("F" = "red", "M" = "blue"))
## I decided, based partially on the findings of my EDA and partially from the goals of
## my project, to filter my dataset to only contain names after 1950. I'm not as interested
## in the gender divide of names from before that time period. My working data for the project
## will be in the aptly named `working_df`:
working_df <- df %>%
filter(year>=1950)
df_one_row_per_name_yr <- working_df %>%
select(-state) %>%
pivot_wider(names_from = gender, values_from = count, values_fill = 0) %>%
mutate(total_count = (F+M)) %>%
mutate(pct_diff = (F-M)/total_count)
## The below dataframe pivots the pct_diff column to wide and then calculates
## the variance of the gender pct_diff per name across the years of the dataset.
## It preserves "na" values
wide_with_var <- df_one_row_per_name_yr %>%
select(name, year, pct_diff) %>%
pivot_wider(
names_from = year,
values_from = pct_diff
) %>%
rowwise() %>%
mutate(
variance = var(c_across(`1950`:`2024`), na.rm = TRUE)
) %>%
ungroup() %>%
select(name, variance, `1950`:`2024`)
## Plotting a histogram of the variance values yields what I would largely expect:
## most names have a variance near 0, very few have variance>0
wide_with_var %>%
ggplot() +
aes(x=variance) +
geom_histogram(bins = 10)
## I made this dataframe to serve as a reference that I can merge into the variance dataframe,
## which will allow me to further refine the names I analyze by their total counts
total_count_wide <- df_one_row_per_name_yr %>%
select(name, year, total_count) %>%
pivot_wider(
names_from = year,
values_from = total_count,
values_fill = 0
) %>%
rowwise() %>%
mutate(
sum_count = sum(c_across(`1950`:`2024`), na.rm = TRUE)
) %>%
ungroup() %>%
select(name, sum_count)
## I created the below dataframe that only selects the columns `name` and `variance`
only_var <- wide_with_var %>%
select(name, variance)
## I made the below dataframe by combining the variance and sum_count columns from the
## above datasets on the name column. The resulting dataframe has 14970 rows, the same
## amount as the two intermediate dataframes
var_and_count_all <- inner_join(only_var, total_count_wide, by = "name")
var_and_count_all %>%
ggplot() +
aes(x=variance, y=sum_count) +
geom_point(alpha=0.2)
var_over_zero <- var_and_count_all %>%
filter(variance>0)
View(var_over_zero)
View(df)
View(df)
View(df_one_row_per_name_yr)
View(only_var)
View(total_count_wide)
View(var_and_count_all)
View(var_over_zero)
View(wide_with_var)
View(wide_with_var)
var_over_zero %>%
ggplot() +
aes(x=variance, y=sum_count) +
geom_point(alpha=0.2)
var_over_zero <- var_and_count_all %>%
filter(variance>0)
var_over_zero %>%
ggplot() +
aes(x=variance, y=sum_count) +
geom_point(alpha=0.2)
var_over_zero %>%
ggplot() +
aes(x=sum_count) +
geom_histogram(bins = 100)
var_over_zero %>%
ggplot() +
aes(x=variance) +
geom_histogram(bins = 100)
var_count_filtered <- var_over_zero %>%
filter(variance>0.15) %>%
filter(sum_count>5000)
list_of_names <- var_count_filtered$name
var_count_filtered %>%
ggplot() +
aes(x=variance, y=sum_count) +
geom_point()
only_w_list_of_names <- df_one_row_per_name_yr %>%
filter(name %in% list_of_names)
for (i in list_of_names) {
## 1. Define/find some variables for later
title <- paste0("All names with variance>0.1 and count>5000 in the dataset with ", i, " highlighted")
sum <- sum(var_count_filtered$sum_count[var_count_filtered$name == i])
var <- sum(var_count_filtered$variance[var_count_filtered$name == i])
subtitle <- paste0("The name ", i, " appeared ", sum, " times in the dataset and had a variance of ", var, ".")
## 2. Make the plot
p <- ggplot(data = only_w_list_of_names) +
aes(x=year, y=pct_diff, group=name) +
## 3. First geom_line adds all names as black lines
geom_line(color="black", linewidth=0.5, alpha=0.25) +
## 4. Second geom_line adds the particular name in a thicker red line on top
geom_line(data = filter(only_w_list_of_names, name==i), color = "red", linewidth=1) +
## 5. Reference previously defined variables to add labels
labs(
title = title,
subtitle = str_wrap(subtitle, 60)
)
filename <- paste0("plots/", i, ".png")
ggsave(filename, plot=p, width = 6, height = 4, units = "in")
}
only_morgan <- only_w_list_of_names %>%
filter(name == "Morgan")
only_morgan <- only_morgan %>%
mutate(real_pct_diff = (pct_diff/2)+0.5) %>%
mutate(bigger_share = ifelse(F > M, "Female", "Male"))
only_morgan_longer <- only_morgan %>%
pivot_longer(
cols = c("F", "M"),
names_to = "Gender",
values_to = "Count"
)
morgan_plot <- ggplot(data = only_morgan) +
aes(x=year, y=real_pct_diff, color = bigger_share) +
geom_line(color="black", size=0.5, alpha=0.5) +
geom_point(size=2) +
geom_hline(yintercept = 0, color = "black", linewidth = 0.25, alpha = 0.25) +
geom_hline(yintercept = 0.25, color = "black", linewidth = 0.25, alpha = 0.25) +
geom_hline(yintercept = 0.5, linetype = "dashed", color = "gray10", linewidth = 0.5, alpha = 0.75) +
geom_hline(yintercept = 0.75, color = "black", linewidth = 0.25, alpha = 0.25) +
geom_hline(yintercept = 1, color = "black", linewidth = 0.25, alpha = 0.25) +
geom_vline(xintercept = 1950, color = "black", linewidth = 0.25, alpha = 0.25) +
geom_vline(xintercept = 1965, color = "black", linewidth = 0.25, alpha = 0.25) +
geom_vline(xintercept = 1980, color = "black", linewidth = 0.25, alpha = 0.25) +
geom_vline(xintercept = 1995, color = "black", linewidth = 0.25, alpha = 0.25) +
geom_vline(xintercept = 2010, color = "black", linewidth = 0.25, alpha = 0.25) +
geom_vline(xintercept = 2025, color = "black", linewidth = 0.25, alpha = 0.25) +
geom_hline(yintercept = 0.6825397, color = "hotpink", linewidth = 0.5, linetype = "dashed", alpha=0.5) +
scale_y_continuous(breaks = c(0, .25, .5, .75, 1),
limits = c(0, 1),
labels = scales::label_percent(scale = 100)) +
scale_x_continuous(breaks = c(1950, 1965, 1980, 1995, 2010, 2025)) +
scale_color_manual(values = c("Female" = "hotpink", "Male" = "dodgerblue")) +
annotate("text",
x = 2025, y = 0.53,
label = "More Female ↑",
color = "black", size = 4,
fontface = "bold", alpha=.75, hjust=1) +
annotate("text",
x = 2025, y = 0.47,
label = "More Male ↓",
color = "black", size = 4,
fontface = "bold", alpha=.75, hjust=1) +
annotate("text",
x = 2023, y = 0.66,
label = "68% Female",
color = "hotpink", size = 3,
fill = "white",
fontface = "bold", alpha=.75, hjust=1) +
labs(
title = "The name 'Morgan' might be past its mostly-female peak",
subtitle = "Share of babies named Morgan who were female from 1950-2024",
x = "Year of Birth",
y = "Percent Female",
color = "Majority Gender",
caption = "Created by Holden Green | Data source: SSA Baby Names"
) +
theme_test() +
theme(legend.position = "top",
legend.justification = "left",
legend.background = element_rect(color="gray15", linetype="solid", linewidth = 0.25),
legend.margin = margin(3,5,3,5),
legend.title = element_text(size=7),
legend.text = element_text(size=7),
legend.key.size = unit(0.75,"line")) +
guides(color=guide_legend(override.aes = list(size=2)))
ggsave(paste0("~/Desktop/CJS/0126algorithms/HW-in-one-chart-1/morgan.png"), plot=morgan_plot, width = 6, height = 5, units = "in")
View(wide_with_var)
View(wide_with_var)
View(df)
